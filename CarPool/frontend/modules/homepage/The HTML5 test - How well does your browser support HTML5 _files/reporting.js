(function(e,d){if(e.addEventListener){return}function a(g){var f=d[g];d[g]=function(h){return b(f(h))}}function c(f,h,g){return(g=this).attachEvent("on"+f,function(i){var i=i||e.event;i.preventDefault=i.preventDefault||function(){i.returnValue=false};i.stopPropagation=i.stopPropagation||function(){i.cancelBubble=true};h.call(g,i)})}function b(g,f){if(!g){return g}if(f=g.length){while(f--){g[f].addEventListener=c}}else{g.addEventListener=c}return g}b([d,e]);if("Element" in e){e.Element.prototype.addEventListener=c}else{d.attachEvent("onreadystatechange",function(){b(d.all)});a("getElementsByTagName");a("getElementById");a("createElement");b(d.all)}})(window,document);var FeatureTable=function(){this.initialize.apply(this,arguments)};FeatureTable.prototype={initialize:function(a){this.parent=a.parent;this.tests=a.tests;this.options={title:a.title||"",browsers:a.browsers||[],columns:a.columns||2,header:a.header||false,links:a.links||false,grading:a.grading||false,bonus:a.bonus||false,features:a.features||false,explainations:a.explainations||false,onChange:a.onChange||false};this.panel=null;if(this.options.links){var c=this;function d(h){if(c.panel){var f=c.panel.parentNode;var g=h.target;while(g.parentNode){if(g==c.panel){return}g=g.parentNode}c.panel.parentNode.removeChild(c.panel);c.panel=null;var g=h.target;while(g.parentNode){if(g==f){return h.stopPropagation()}g=g.parentNode}}}document.addEventListener("click",d,true);document.addEventListener("touchstart",d,true)}this.data=[];for(var b=0;b<this.options.columns;b++){this.data[b]=null}this.createSections(this.parent)},loadColumn:function(b,e){var c=this;var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLHTTP")}}a.open("POST","/api/loadBrowser",true);a.onreadystatechange=d;a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send("id="+encodeURIComponent(e));function d(){if(a.readyState==4&&a.responseText!=""){var f=JSON.parse(a.responseText);c.updateColumn(b,f)}}},calculateColumn:function(a){var b=this;new Test(c);function c(d){b.updateColumn(a,{id:"mybrowser",nickname:t("My browser"),score:d.score,bonus:d.bonus,points:d.points,results:d.results})}},clearColumn:function(d){this.data[d]=null;if(this.options.onChange){var c=[];for(var b=0;b<this.options.columns;b++){if(this.data[b]){c.push(this.data[b].id)}}this.options.onChange(c)}if(this.options.header){var e=document.getElementById("row-header");var a=e.childNodes[d+1];a.className="empty";a.firstChild.firstChild.innerHTML="";a.firstChild.childNodes[1].selectedIndex=0}for(var b=0;b<this.tests.length;b++){if(typeof this.tests[b]!="string"){if(typeof this.tests[b].items!="undefined"){var e=document.getElementById("head-"+tests[b].id);var a=e.childNodes[d+1];a.innerHTML="";this.clearItems(d,this.tests[b].id,this.tests[b].items)}}}},clearItems:function(d,f,c){for(var b=0;b<c.length;b++){if(typeof c[b]!="string"){var e=document.getElementById("row-"+f+"-"+c[b].id);var a=e.childNodes[d+1];a.innerHTML="";if(typeof c[b].items!="undefined"){this.clearItems(d,f+"-"+c[b].id,c[b].items)}}}},updateColumn:function(c,e){this.data[c]=e;if(this.options.onChange){var a=[];for(var f=0;f<this.options.columns;f++){if(this.data[f]){a.push(this.data[f].id)}}this.options.onChange(a)}if(this.options.header){var m=document.getElementById("row-header");var l=m.childNodes[c+1];l.className="";l.firstChild.firstChild.innerHTML='<span class="nickname">'+t(e.nickname)+'</span><span class="score">'+e.score+'</span><span class="bonus">'+e.bonus+" "+t("bonus points")+"</span>"}for(var f=0;f<this.tests.length;f++){if(typeof this.tests[f]!="string"){if(typeof this.tests[f].items!="undefined"){var k=0;var d=0;var j=0;if(match=(new RegExp(tests[f].id+"=([0-9]+)(?:\\/([0-9]+))?(?:\\+([0-9]+))?")).exec(e.points)){k=match[1];if(match[2]){d=match[2]}if(match[3]){j=match[3]}}var m=document.getElementById("head-"+tests[f].id);var l=m.childNodes[c+1];var h="<div><div class='grade'>";if(this.options.bonus&&j>0){h+="<span class='bonus'>+"+j+"<span> "+t("bonus points")+"</span></span>"}if(this.options.grading){var b="";var g=parseInt(k/d*100,10);switch(true){case g==0:b="none";break;case g<=30:b="badly";break;case g<=60:b="reasonable";break;case g<=95:b="good";break;default:b="great";break}if(k==d){h+="<span class='"+b+"'>"+k+"</span>"}else{h+="<span class='"+b+"'>"+k+"/"+d+"</span>"}}else{h+="<span>"+k+"</span>"}h+="</div></div>";l.innerHTML=h;this.updateItems(c,e,0,this.tests[f].id,this.tests[f].items)}}}},updateItems:function(e,h,a,c,d){var k=[0,0];for(var j=0;j<d.length;j++){if(typeof d[j]!="string"){var b=false;var g=null;var m=c+"-"+d[j].id;if(match=(new RegExp(m+"=([0|1])")).exec(h.results)){g=match[1]=="1"}else{b=true}var n=document.getElementById("row-"+c+"-"+d[j].id);var l=n.childNodes[e+1];if(typeof d[j].items!="undefined"){var f=this.updateItems(e,h,a+1,c+"-"+d[j].id,d[j].items);if(f[0]==f[1]){l.innerHTML=t("Yes")+' <span class="check">✔</span>'}else{if(f[1]==0){l.innerHTML=t("No")+' <span class="ballot">✘</span>'}else{l.innerHTML='<span class="partially">'+t("Partial")+'</span> <span class="partial">○</span>'}}}else{if(b){l.innerHTML='<span class="partially">'+t("Unknown")+'</span> <span class="partial">?</span>'}else{if(g){l.innerHTML=t("Yes")+' <span class="check">✔</span>'}else{l.innerHTML=t("No")+' <span class="ballot">✘</span>'}}}k[0]++;if(g){k[1]++}}}return k},createSections:function(q){if(this.options.header){var s=document.createElement("table");s.id="table-header";q.appendChild(s);var h=document.createElement("tbody");s.appendChild(h);var o=document.createElement("tr");o.id="row-header";h.appendChild(o);var d=document.createElement("th");d.innerHTML=this.options.title;o.appendChild(d);for(var n=0;n<this.options.columns;n++){var f=document.createElement("td");f.className="empty";o.appendChild(f);var b=document.createElement("div");f.appendChild(b);var a=document.createElement("div");a.className="name";b.appendChild(a);var e=document.createElement("div");e.className="popup";b.appendChild(e);var p=document.createElement("div");e.appendChild(p);var j=document.createElement("ul");p.appendChild(j);var r=document.createElement("li");r.innerHTML=t("My browser");j.appendChild(r);(function(w,v,u,i){u.addEventListener("click",function(c){v.className="popup";i.calculateColumn(w);c.stopPropagation()},true)})(n,e,r,this);var m=null;for(var g=0;g<this.options.browsers.length;g++){if(m!=this.options.browsers[g].type){var r=document.createElement("li");r.className="indent-0 title";j.appendChild(r);switch(this.options.browsers[g].type){case"desktop":r.innerHTML=t("Desktop browsers");break;case"gaming":r.innerHTML=t("Gaming");break;case"mobile":r.innerHTML=t("Mobiles");break;case"tablet":r.innerHTML=t("Tablets");break;case"television":r.innerHTML=t("Television");break}}var r=document.createElement("li");r.innerHTML=this.options.browsers[g].nickname+(this.options.browsers[g].details?" <em>("+this.options.browsers[g].details+")</em>":"");j.appendChild(r);(function(x,v,u,w,i){u.addEventListener("click",function(c){v.className="popup";i.loadColumn(x,w);c.stopPropagation()},true)})(n,e,r,this.options.browsers[g].id,this);m=this.options.browsers[g].type}(function(i,v,u){document.body.addEventListener("click",function(c){u.className="popup"},true);a.addEventListener("click",function(c){if(i.data[v]==null){if(c.altKey){var w=prompt(t("Enter the unique id of the results you want to see"));if(w){i.loadColumn(v,"custom:"+w)}}else{u.className="popup visible"}}else{i.clearColumn(v)}c.stopPropagation()},true)})(this,n,e)}}for(var g=0;g<this.tests.length;g++){if(typeof this.tests[g]=="string"){var l=document.createElement("h2");l.innerHTML=t(tests[g]);q.appendChild(l)}else{var s=document.createElement("table");s.id="table-"+tests[g].id;q.appendChild(s);var k=document.createElement("thead");s.appendChild(k);var o=document.createElement("tr");o.id="head-"+tests[g].id;k.appendChild(o);var d=document.createElement("th");d.innerHTML=t(this.tests[g].name);o.appendChild(d);for(var n=0;n<this.options.columns;n++){var f=document.createElement("td");o.appendChild(f)}if(typeof this.tests[g].items!="undefined"){var h=document.createElement("tbody");s.appendChild(h);this.createItems(h,0,this.tests[g].id,this.tests[g].items)}}}},createItems:function(o,b,e,g,p){var a=[];for(var j=0;j<g.length;j++){var n=document.createElement("tr");o.appendChild(n);if(typeof g[j]=="string"){if(this.options.explainations||g[j].substr(0,4)!="<em>"){var d=document.createElement("th");d.colSpan=this.options.columns+1;d.className="details";n.appendChild(d);d.innerHTML=t(g[j])}}else{var d=document.createElement("th");d.innerHTML="<span>"+t(g[j].name)+"</span>";n.appendChild(d);for(var m=0;m<this.options.columns;m++){var h=document.createElement("td");n.appendChild(h)}n.id="row-"+e+"-"+g[j].id;if(b>0){n.className="isChild"}if(typeof g[j].items!="undefined"){var l=null;if(this.options.links){if(typeof g[j].urls!="undefined"){l=g[j].urls}else{if(typeof g[j].url!="undefined"){l={w3c:g[j].url}}}}n.className+="hasChild";var f=this.createItems(o,b+1,e+"-"+g[j].id,g[j].items,l);this.hideChildren(n,f);(function(q,r,i,c){i.onclick=function(){q.toggleChildren(r,c)}})(this,n,d,f)}else{if(this.options.features){d.innerHTML="<a href='/compare/feature/"+e+"-"+g[j].id+".html'>"+t(g[j].name)+" <span>»</span></a>"}if(this.options.links){var l;var k=false;if(typeof g[j].urls!="undefined"){l=g[j].urls;k=true}else{if(typeof g[j].url!="undefined"){l={w3c:g[j].url};k=true}}if(k){d.className="hasLink";(function(r,q,u,i,c,s){q.onclick=function(){r.showLinks(q,u,i,c,s)}})(this,d,e+"-"+g[j].id,g[j].name,p,l)}}}a.push(n.id)}}return a},showLinks:function(d,g,c,b,f){if(this.panel){this.panel.parentNode.removeChild(this.panel);this.panel=null}var a={};if(b){for(key in b){a[key]=b[key]}}if(f){for(key in f){a[key]=f[key]}}var e="<a href='/compare/feature/"+g+".html' class='compare'>"+t("Compare browsers")+"</a>";if(typeof a.w3c!="undefined"){e+="<a href='"+a.w3c+"' class='w3c'>"+t("Go to the specification at W3C.org")+"</a>"}if(typeof a.khronos!="undefined"){e+="<a href='"+a.khronos+"' class='khronos'>"+t("Go to the specification at Khronos.org")+"</a>"}if(typeof a.wp!="undefined"){e+="<a href='http://docs.webplatform.org/wiki"+a.wp+"' class='wp'>"+t("Documentation at WebPlatform.org")+"</a>"}if(typeof a.mdn!="undefined"){e+="<a href='https://developer.mozilla.org/en-US/docs"+a.mdn+"' class='mdn'>"+t("Documentation at Mozilla Developer Network")+"</a>"}this.panel=document.createElement("div");this.panel.className="linksPanel";this.panel.innerHTML=e;d.appendChild(this.panel)},toggleChildren:function(a,b){if(a.className.indexOf(" hidden")==-1){this.hideChildren(a,b)}else{this.showChildren(a,b)}},showChildren:function(b,c){b.className=b.className.replace(" hidden","");for(var a=0;a<c.length;a++){var d=document.getElementById(c[a]);d.style.display="table-row"}},hideChildren:function(b,c){b.className=b.className.replace(" hidden","");b.className+=" hidden";for(var a=0;a<c.length;a++){var d=document.getElementById(c[a]);d.style.display="none"}}};var BrowserTable=function(){this.initialize.apply(this,arguments)};BrowserTable.prototype={initialize:function(a){this.parent=a.parent;this.browsers=a.browsers;this.options={title:a.title||"",tests:a.tests||[],columns:a.columns||2,header:a.header||false,links:a.links||false,grading:a.grading||false,bonus:a.bonus||false,explainations:a.explainations||false,onChange:a.onChange||false};this.data=[];for(var b=0;b<this.options.columns;b++){this.data[b]=null}this.createSections(this.parent)},loadColumn:function(b,e){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLHTTP")}}a.open("POST","/api/loadFeature",true);a.onreadystatechange=d;a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send("id="+encodeURIComponent(e));var c=this;function d(){if(a.readyState==4&&a.responseText!=""){var f=JSON.parse(a.responseText);c.updateColumn(b,f)}}},clearColumn:function(d){this.data[d]=null;if(this.options.onChange){var c=[];for(var b=0;b<this.options.columns;b++){if(this.data[b]){c.push(this.data[b].id)}}this.options.onChange(c)}if(this.options.header){var e=document.getElementById("row-header");var a=e.childNodes[d+1];a.className="empty";a.firstChild.firstChild.innerHTML="";a.firstChild.childNodes[1].selectedIndex=0}for(var b=0;b<this.browsers.length;b++){var e=document.getElementById("row-"+this.browsers[b].uid);var a=e.childNodes[d+1];a.innerHTML=""}},updateColumn:function(d,f){this.data[d]=f;if(this.options.onChange){var c=[];for(var b=0;b<this.options.columns;b++){if(this.data[b]){c.push(this.data[b].id)}}this.options.onChange(c)}if(this.options.header){var g=document.getElementById("row-header");var a=g.childNodes[d+1];a.className="";var e;if(e=this.getItemById(this.options.tests,f.id)){a.firstChild.firstChild.innerHTML='<span class="feature">'+t(e.name)+"</span>"}}for(var b=0;b<this.browsers.length;b++){var g=document.getElementById("row-"+this.browsers[b].uid);var a=g.childNodes[d+1];if(match=(new RegExp(this.browsers[b].id+"=1")).exec(f.supported)){a.innerHTML=t("Yes")+' <span class="check">✔</span>'}else{a.innerHTML=t("No")+' <span class="ballot">✘</span>'}}},createSections:function(p){if(this.options.header){var r=document.createElement("table");r.id="table-header";p.appendChild(r);var j=document.createElement("tbody");r.appendChild(j);var n=document.createElement("tr");n.id="row-header";j.appendChild(n);var d=document.createElement("th");d.innerHTML=this.options.title;n.appendChild(d);for(var m=0;m<this.options.columns;m++){var g=document.createElement("td");g.className="empty";n.appendChild(g);var b=document.createElement("div");g.appendChild(b);var a=document.createElement("div");a.className="name";b.appendChild(a);var e=document.createElement("div");e.className="popup";b.appendChild(e);var o=document.createElement("div");e.appendChild(o);var k=document.createElement("ul");o.appendChild(k);var f=this.getList(this.options.tests);for(var h=0;h<f.length;h++){var q=document.createElement("li");q.className="indent-"+f[h].indent;q.innerHTML=t(f[h].name);k.appendChild(q);if(typeof f[h].id=="undefined"){q.className+=" title"}(function(w,u,s,v,i){s.addEventListener("click",function(c){if(v){u.className="popup";i.loadColumn(w,v)}c.stopPropagation()},true)})(m,e,q,f[h].id,this)}(function(i,u,s){document.body.addEventListener("click",function(c){s.className="popup"},true);a.addEventListener("click",function(c){if(i.data[u]==null){s.className="popup visible"}else{i.clearColumn(u)}c.stopPropagation()},true)})(this,m,e)}}var r=document.createElement("table");p.appendChild(r);var j=document.createElement("tbody");r.appendChild(j);var l=null;for(var h=0;h<this.browsers.length;h++){if(l!=this.browsers[h].type){var n=document.createElement("tr");j.appendChild(n);var d=document.createElement("th");d.className="details";d.colspan=this.options.columns+1;n.appendChild(d);switch(this.browsers[h].type){case"desktop":d.innerHTML="<h3>"+t("Desktop browsers")+"</h3>";break;case"gaming":d.innerHTML="<h3>"+t("Gaming")+"</h3>";break;case"mobile":d.innerHTML="<h3>"+t("Mobiles")+"</h3>";break;case"tablet":d.innerHTML="<h3>"+t("Tablets")+"</h3>";break;case"television":d.innerHTML="<h3>"+t("Television")+"</h3>";break}}var n=document.createElement("tr");n.id="row-"+this.browsers[h].uid;j.appendChild(n);var d=document.createElement("th");d.innerHTML="<a href='/compare/browser/"+this.browsers[h].id+".html'>"+this.browsers[h].nickname+(this.browsers[h].details?" <em>("+this.browsers[h].details+")</em>":"")+" <span>»</span></a>";n.appendChild(d);for(var m=0;m<this.options.columns;m++){var g=document.createElement("td");n.appendChild(g)}l=this.browsers[h].type}},getList:function(b,g,e){if(typeof g=="undefined"){g=0}if(typeof e=="undefined"){e=""}var a=[];for(var d=0;d<b.length;d++){if(typeof b[d]=="object"){if(typeof b[d].items=="undefined"){a.push({id:e+b[d].id,name:b[d].name,indent:g})}if(typeof b[d].items!="undefined"){a.push({name:b[d].name,indent:g});if(children=this.getList(b[d].items,g+1,e+b[d].id+"-")){for(var f=0;f<children.length;f++){a.push(children[f])}}}}}return a},getItemById:function(a,d,c){if(typeof c=="undefined"){c=""}for(var b=0;b<a.length;b++){if(typeof a[b]=="object"){if(c+a[b].id==d){return a[b]}if(typeof a[b].items!="undefined"){if(result=this.getItemById(a[b].items,d,c+a[b].id+"-")){return result}}}}}};